L.StreetLabels=L.LabelTextCollision.extend({options:{propertyName:"name",showLabelIf:null,fontStyle:{dynamicFontSize:!1,fontSize:10,fontSizeUnit:"px",lineWidth:4,fillStyle:"black",strokeStyle:"white"}},initialize:function(t){L.LabelTextCollision.prototype.initialize.call(this,t),L.Util.stamp(this),this._layers=this._layers||{}},_initContainer:function(t){if(L.LabelTextCollision.prototype._initContainer.call(this,t),this._map){var e=function(){this._reset(),this._redraw()}.bind(this);this._map.on("layerremove",L.Util.throttle(e,32,this))}},_text:function(s,t){if(t&&t.feature&&t.feature.properties&&"undefined"!==t.feature.properties[this.options.propertyName]){if(this.options.showLabelIf&&!1===this.options.showLabelIf.call(this,t.feature))return;var e,o=t.feature.properties[this.options.propertyName];if(s.globalAlpha=1,0===t._parts.length||0===t._parts[0].length)return;if(!(e=t instanceof L.Polygon&&this._map.hasLayer(t)?this._getCentroid(t):this._getCenter(t._parts[0])))return;s.lineWidth=this.options.fontStyle.lineWidth;var i=this.options.fontStyle.fontSize;this._map&&!0===this.options.fontStyle.dynamicFontSize&&(i=this._getDynamicFontSize()),s.font=i+this.options.fontStyle.fontSizeUnit+" 'Helvetica Neue',Helvetica,Arial,sans-serif";var n=s.measureText(o).width+e.x,a=e.y+0+20,r=L.bounds(L.point(e.x+0,e.y+0),L.point(n,a));if(this.options.collisionFlg)for(var l in this._textList){if(this._textList[l].intersects(r))return}if(this._textList.push(r),s.fillStyle=this.options.fontStyle.fillStyle,s.strokeStyle=this.options.fontStyle.strokeStyle,t instanceof L.Polygon||t instanceof L.CircleMarker){var h=s.measureText(o).width;s.strokeText(o,e.x+0-h/2,e.y+0),s.fillText(o,e.x+0-h/2,e.y+0)}if(t instanceof L.Polyline){var f=t.getLatLngs()[0],p=t.getLatLngs()[t.getLatLngs().length-1];this._getBearing(f,p)<0&&(t=this._getLineStringReverse(t)),t._parts&&(s.textAlign="center",s.textBaseline="middle",s.lineWidth=3,t._parts.forEach(function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];e.push(n.x),e.push(n.y)}s.textPath(o,e)}))}}},_getBearing:function(t,e){var i=Math.PI/180,n=t.lat*i,s=e.lat*i,o=t.lng*i,a=e.lng*i,r=Math.sin(a-o)*Math.cos(s),l=Math.cos(n)*Math.sin(s)-Math.sin(n)*Math.cos(s)*Math.cos(a-o),h=(180*Math.atan2(r,l)/Math.PI+360)%360;return 180<=h?h-360:h},_getLineStringReverse:function(t){var e=t.getLatLngs().slice(0).reverse();return t.setLatLngs(e),t},_getDynamicFontSize:function(){return parseInt(this._map.getZoom())},_getCentroid:function(t){if(t&&t.getCenter&&this._map){var e=t.getCenter(),i=this._map.latLngToContainerPoint(e);return this._map.containerPointToLayerPoint(i)}}});